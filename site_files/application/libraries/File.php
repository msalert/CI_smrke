<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');define('TEMP_DIR',$_SERVER['DOCUMENT_ROOT'].'/_/images/temp/');define('UPLOAD_DIR',$_SERVER['DOCUMENT_ROOT'].'/_/images/uploaded/');class File {     private $allowed_types = array('image/png','image/jpg','image/jpeg','image/gif');     private $max_size = 2000000;     public $file;     public $errors = array();          function __construct($file=NULL) {         if($file){             $this->file = json_decode($file,true);//             echo "<pre>".print_r($this->file,true)."</pre>"; die;         }     }          public function grabFile($file){         if($this->checkFile($file)){             // save file to temp dir            $this->file = $file;            if(move_uploaded_file($this->file['tmp_name'], TEMP_DIR.$this->file['name'])){                $this->file['filepath'] = str_replace($_SERVER['DOCUMENT_ROOT'],'',TEMP_DIR.$this->file['name']);                return true;             }            else return false;         }     }          /*      *  @return       */     public function saveFile($path=NULL){//        echo "<pre>".print_r($this->file,true)."</pre>"; die;         $path = $path? $path:UPLOAD_DIR;         if(rename(TEMP_DIR.$this->file['file']['name'],$path.$this->file['file']['name'])){             return $path.$this->file['file']['name'];         }else{             return NULL;         }                 }          public function errors(){         if(count($this->errors)===0) return false;         else return $this->errors;     }          public function getJSON(){         $obj->file = $this->file;         if(count($this->errors))            $obj->errors = $this->errors;         return json_encode($obj);     }          private function checkFile($file){         $state = true;         if($file["size"] > $this->max_size){            $state = false;            $this->errors['size']=$file['size'].' bytes. File too large.';         }         if(!in_array($file["type"], $this->allowed_types)){            $state = false;             $this->errors['type']=$file['type'].' is not an allowed type.';         }         if($file["error"] !== 0){            $state = false;             $this->errors['error']=$file["error"];         }         return $state;     } // end function checkFile               }//function upload_image(){//		if(0){////	    	$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/uploaded/";////			$filename = $_FILES["file"]["name"];////		////		    if (file_exists($path.$_FILES["file"]["name"])){////		      // echo $_FILES["file"]["name"] . " already exists. ";////					echo "<script type='text/javascript'>if(confirm(\"File already exists. Use existing image?\")) {parent.document.getElementById(\"uploaded-image\").src=\"".base_url()."_/images/uploaded/".$filename."\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-exists\",\"true\");}</script>";////			}else{////				move_uploaded_file($_FILES["file"]["tmp_name"], $path.$filename);//// 					////				echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url()."_/images/uploaded/".$filename."\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-exists\",\"false\");</script>";////			}////		}else{////			echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////		}////		////	}////////	function upload_p_image(){////		if (isset($_SESSION['user']) && $_SESSION['user']->type == 1){////	    	$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/p_images/";////			$f = $_FILES;////			$mode = $_POST['mode'];////			$thumbwidth=200;////			$thumbheight=200;////			////			$filename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight); ////			if($filename){////				echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url()."_/images/p_images/".$filename."\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-filename\",\"".$filename."\");</script>";////			}else{////				echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////			}////		}			////	}////////	function upload_cat_thumb(){////		if (isset($_SESSION['user']) && $_SESSION['user']->type == 1){////	    	$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/cat_images/thumbs/";////			$f = $_FILES;////			$mode = $_POST['mode'];////			$thumbwidth=200;////			$thumbheight=200;////			////			$filename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight); ////			if($filename){////				echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url()."_/images/cat_images/thumbs/".$filename."\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-filename\",\"".$filename."\");</script>";////			}else{////				echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////			}////		}////	}////	////	function upload_service_thumb(){////		if (isset($_SESSION['user']) && $_SESSION['user']->type == 1){////	    	$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/service_images/";////			$f = $_FILES;////			$mode = $_POST['mode'];////			$thumbwidth=200;////			$thumbheight=200;////			////			$filename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight); ////			if($filename){////				echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url()."_/images/service_images/".$filename."\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-filename\",\"".$filename."\");</script>";////			}else{////				echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////			}////		}////	}////////	function upload_product_image(){////		if (isset($_SESSION['user']) && $_SESSION['user']->type == 1){////			////			$f = $_FILES;				////			$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/product_images/";////			$mode = $_POST['mode'];////			$thumbwidth=340;////			$thumbheight=225;////			////			$filename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight); ////			if($filename){////				// Generate thumb////				$thumbwidth=100;////				$thumbheight=100;////				$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/product_images/thumbs/";////				$mode = 'crop';////				$tfilename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight);				 					////				echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url().////				"_/images/product_images/$filename\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-filename\",\"$filename\"); parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-thumb-filename\",\"$tfilename\");</script>";			////			}else{////				echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////			}				////							////			////		}////	}////////	function upload_product_thumb_image(){////		if (isset($_SESSION['user']) && $_SESSION['user']->type == 1){////	    	$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/product_images/thumbs/";////			$f = $_FILES;////			$mode = $_POST['mode'];////			$thumbwidth=100;////			$thumbheight=100;////			////			$filename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight); ////			if($filename){////				echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url()."_/images/product_images/thumbs/".$filename."\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-filename\",\"".$filename."\");</script>";////			}else{////				echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////			}////		}////	}////////	 function upload_manufacturer_logo(){////		if (isset($_SESSION['user']) && $_SESSION['user']->type == 1){////							////			$f = $_FILES;				////			$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/uploaded/manufacturers/";////			$mode = $_POST['mode'];////			$thumbwidth=340;////			$thumbheight=65;////			////			$filename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight); ////			if($filename){				 					////				echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url()."_/images/uploaded/manufacturers/".$filename."\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-filename\",\"".$filename."\");</script>";			////			}else{////				echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////			}////////		}////	}////////	function upload_gallery_image(){////		$allowed_types = array('image/png','image/jpg','image/jpeg','image/gif');////		if($_FILES["file"]["size"] < 4000000 && ////		$_FILES["file"]["error"] == 0 && ////		in_array($_FILES["file"]["type"], $allowed_types)){////////			// Generate thumb////			$f = $_FILES;////			$thumbwidth=145;////			$thumbheight=91;////			$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/gallery_images/thumbs/";////			$mode = 'crop';////			$tfilename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight);////			////			// $path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/gallery_images/thumbs/grays/";////			// $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight,true);////			////	    	$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/gallery_images/";////			$filename = str_replace(' ', '-', $_FILES["file"]["name"]);////		////		    if (file_exists($path.$filename)){////		    	$dot_position = strrpos($filename, ".");////				$filename = substr($filename, 0, $dot_position).time().substr($filename, $dot_position);////			}////						////			move_uploaded_file($_FILES["file"]["tmp_name"], $path.$filename);//// 							 					////			echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url().////			"_/images/gallery_images/$filename\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-filename\",\"$filename\"); parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-thumb-filename\",\"$tfilename\");</script>";			////			////		}else{////			echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////		}////		////	}////////	function upload_gallery_thumb_image(){////		if (isset($_SESSION['user']) && $_SESSION['user']->type == 1){////	    	$path = $_SERVER['DOCUMENT_ROOT']."/fps/_/images/gallery_images/thumbs/";////			$f = $_FILES;////			$mode = $_POST['mode'];////			$thumbwidth=145;////			$thumbheight=91;////			////			$filename = $this->_upload_image($f,$path,$mode,$thumbwidth,$thumbheight); ////			if($filename){////				echo "<script type='text/javascript'>parent.document.getElementById(\"uploaded-image\").src=\"".base_url()."_/images/gallery_images/thumbs/".$filename."\"; parent.document.getElementById(\"uploaded-image\").setAttribute(\"data-filename\",\"".$filename."\");</script>";////			}else{////				echo "<script type='text/javascript'>alert(\"Not a valid image file.  Please upload a different file.\");</script>";////			}////		}////	}////	////	private function _upload_image($f,$path,$mode,$final_width,$final_height,$grayscale=false){////		$allowed_types = array('image/png','image/jpg','image/jpeg','image/gif');////		if($f["file"]["size"] < 4000000 && ////		$f["file"]["error"] == 0 && ////		in_array($f["file"]["type"], $allowed_types)){////	////			$filename = str_replace(' ', '-', $f["file"]["name"]);////		////		    if (file_exists($path.$filename)){////		    	$dot_position = strrpos($filename, ".");////				$filename = substr($filename, 0, $dot_position).time().substr($filename, $dot_position);////			}////					////			$temp = $f["file"]["tmp_name"];////		////			//get image size////			$resol = getimagesize($temp); ////			$width = $resol[0];////			$height = $resol[1];////			////			// set defaults for image display size////			$thumbwidth=$final_width;////			$thumbheight=$final_height;////			////			//check image shape////			if($width/$height == ($thumbwidth/$thumbheight)) $case=1;  // correct proportions////			if($width/$height < ($thumbwidth/$thumbheight)) $case=2; // too narrow////			if($width/$height > ($thumbwidth/$thumbheight)) $case=3; // too wide////				////					////					////			// ******   inputs to imagecopyresampled for thumb////			$src_x=0;////			$src_y=0;////			$src_width=$width;////			$src_height=$height;////			////			$dest_x=0;////			$dest_y=0;////			$dest_width=$thumbwidth;////			$dest_height=$thumbheight;////					////			switch ($mode) {////				case 'crop':////					////					switch ($case) {////					  case 1: //correct////												////						break;////					  case 2: //narrow////					  		$src_height = ($width/$thumbwidth)*$thumbheight;////							$src_y = round(($height - $src_height) / 2);////						break;////					  case 3: //wide////							$src_width = ($height/$thumbheight)*$thumbwidth;////							$src_x = round(($width - $src_width) / 2);////						break;////					  default:////						break;////					}////					////					switch ($f["file"]["type"]) {////						case 'image/jpeg':////							$img = imagecreatefromjpeg($temp);////							$thumb = imagecreatetruecolor($thumbwidth, $thumbheight);////							// $new_image = imagecreatetruecolor($newwidth, $newheight);////				////							imagecopyresampled($thumb, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);////							// imagecopyresampled($new_image, $img, 0, 0, 0, 0, $newwidth, $newheight, $width, $height);////							////							if($grayscale) imagefilter($thumb, IMG_FILTER_GRAYSCALE);		////							imagejpeg($thumb, $path.$filename,100);////							return $filename;////						break;////						////						case 'image/gif':////							$img = imagecreatefromgif($temp);////							$thumb = imagecreatetruecolor($thumbwidth, $thumbheight);////		////							// $new_image = imagecreatetruecolor($newwidth, $newheight);////							imagecopyresampled($thumb, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);////							// imagecopyresampled($new_image, $img, 0, 0, 0, 0, $newwidth, $newheight, $width, $height);			////							////							if($grayscale) imagefilter($thumb, IMG_FILTER_GRAYSCALE);////							imagegif($thumb, $path.$filename);////							return $filename;////						break;////		////						case 'image/png':////							$img = imagecreatefrompng($temp);////							$thumb = imagecreatetruecolor($thumbwidth, $thumbheight);////		////							// $new_image = imagecreatetruecolor($newwidth, $newheight);////							imagecopyresampled($thumb, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);////							// imagecopyresampled($new_image, $img, 0, 0, 0, 0, $newwidth, $newheight, $width, $height);			////							////							if($grayscale) imagefilter($thumb, IMG_FILTER_GRAYSCALE);////							imagepng($thumb, $path.$filename,9);////							return $filename;					////						break;////		////						default:////							return false;////						break;////					}////		////					break;////				////				case 'pad-white':////		////					switch ($case) {////					  case 1: //correct////												////						break;////					  case 2: //narrow////					  		$dest_width = round(($dest_height/$height)*$width); ////							$dest_x = round(($thumbwidth - $dest_width) / 2);////						break;////					  case 3: //wide////							$dest_height = round(($dest_width/$width)*$height); ////							$dest_y = round(($thumbheight - $dest_height) / 2);////						break;////					  default:////						break;////					}////					////					$new_image = imagecreatetruecolor($thumbwidth, $thumbheight); ////					$white = imagecolorallocate($new_image, 255, 255, 255);////					imagefill($new_image, 0, 0, $white);////					////					switch ($f["file"]["type"]) {////						case 'image/jpeg':////							$img = imagecreatefromjpeg($temp);////							////				////							imagecopyresampled($new_image, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);						////							imagejpeg($new_image, $path.$filename,100);////							return $filename;////						break;////						////						case 'image/gif':////							$img = imagecreatefromgif($temp);////							////							imagecopyresampled($new_image, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);////							////							imagegif($new_image, $path.$filename);////							return $filename;////						break;////		////						case 'image/png':////							$img = imagecreatefrompng($temp);////							////							imagecopyresampled($new_image, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);////							imagepng($new_image, $path.$filename,9);////							return $filename;					////						break;////		////						default:////							return false;////						break;////					}////					////					break;////					////				case 'pad-black':////		////					switch ($case) {////					  case 1: //correct////												////						break;////					  case 2: //narrow////					  		$dest_width = round(($dest_height/$height)*$width); ////							$dest_x = round(($thumbwidth - $dest_width) / 2);////						break;////					  case 3: //wide////							$dest_height = round(($dest_width/$width)*$height); ////							$dest_y = round(($thumbheight - $dest_height) / 2);////						break;////					  default:////						break;////					}////					////					$new_image = imagecreatetruecolor($thumbwidth, $thumbheight); ////					$black = imagecolorallocate($new_image, 0, 0, 0);////					imagefill($new_image, 0, 0, $black);////					////					switch ($f["file"]["type"]) {////						case 'image/jpeg':////							$img = imagecreatefromjpeg($temp);////							////				////							imagecopyresampled($new_image, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);						////							imagejpeg($new_image, $path.$filename,100);////							return $filename;////						break;////						////						case 'image/gif':////							$img = imagecreatefromgif($temp);////							////							imagecopyresampled($new_image, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);////							////							imagegif($new_image, $path.$filename);////							return $filename;////						break;////		////						case 'image/png':////							$img = imagecreatefrompng($temp);////							////							imagecopyresampled($new_image, $img,$dest_x, $dest_y, $src_x, $src_y,$dest_width, $dest_height, $src_width, $src_height);////							imagepng($new_image, $path.$filename,9);////							return $filename;////						break;////		////						default:////							return false;////						break;////					}////					////					break;////						////				default:////					return false;////					break;////			}////				 				////		}else{////			return false;////		}////	}//////}